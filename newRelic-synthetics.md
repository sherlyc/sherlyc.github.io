# New Relic Synthetics Test

##### Notes: Do not edit this file unless you intend to update the synthetics script running at our SPADE Homepage in New Relic:

https://synthetics.newrelic.com/accounts/1406710/monitors/454add9d-3b29-4fad-9bc9-25ce72d8f16a/script
Currently this will run every 5 minutes to check for elements on i.stuff.co.nz.

```javascript
const assert = require("assert");
const blackListed = [
  "https://somniture.stuff.co.nz",
  "https://fonts.googleapis.com"
];
$browser.addHostnamesToBlacklist(blackListed);
const getCssElement = (selector) => {
  console.log("getCssElement", selector);
  return $browser.waitForAndFindElement($driver.By.css(selector), 8000);
};

const selectMobileSite = async () => {
  const element = await getCssElement(".view-mobile-site");
  element.click();
};

const closeOLI = async () => {
  console.log("checking oli, closing it if found");
  try {
    const OliCloseBtn = await $browser.waitForAndFindElement(
      $driver.By.partialLinkText("close ad"),
      10000
    );
    return OliCloseBtn.click();
  } catch (e) {
    console.log("OLI was not found");
  }
};
const shouldContainHalfWidthImageArticleUnits = async () => {
  console.log("checking for half width image article unit, no error means ok");
  const element = await getCssElement("app-half-width-image-article-unit");
  return assert(
    element.getText() != null,
    "app-half-width-image-article-unit is null"
  );
};
const shouldContainHeader = async () => {
  console.log("checking header, no error means ok");
  const element = await getCssElement("app-header");
  return assert(element != null, "app-header element is null");
};
const shouldContainBasicAdUnit = async () => {
  const element = await getCssElement("app-basic-ad-unit[id] iframe");
  return assert(element != null, "no ad unit is found");
};
const shouldContainTopStories = async () => {
  console.log("checking top stories highlight");
  const allGrids = await $browser.findElements(
    $driver.By.css("app-grid-container > div > div > app-grid-container")
  );
  const topStoriesHighlight = await allGrids[0];
  const featuredArticles = await topStoriesHighlight.findElements(
    $driver.By.css("app-featured-article")
  );
  const bigImageArticles = await topStoriesHighlight.findElements(
    $driver.By.css("app-big-image-article-unit")
  );
  const halfWidthImageArticles = await topStoriesHighlight.findElements(
    $driver.By.css("app-half-width-image-article-unit")
  );
  const topStoriesCount =
    featuredArticles.length +
    bigImageArticles.length +
    halfWidthImageArticles.length;
  return assert(
    topStoriesCount >= 2,
    "top stories highlight does not display a minimum of 2 articles"
  );
};
const shouldContainFooter = async () => {
  console.log("checking footer, no error means ok");
  const element = await getCssElement("app-footer");
  return assert(element != null, "footer element is null");
};
$browser
  .get("https://i.stuff.co.nz")
  .then(selectMobileSite)
  .then(() => {
    return $browser.get("https://i.stuff.co.nz");
  })
  .then(closeOLI)
  .then(shouldContainHalfWidthImageArticleUnits)
  .then(shouldContainHeader)
  .then(shouldContainTopStories)
  .then(shouldContainBasicAdUnit)
  .then(shouldContainFooter);
```

# New Relic Synthetics Test

##### Notes: Do not edit this file unless you intend to update the synthetics script running at our SPADE Homepage in New Relic:

https://synthetics.newrelic.com/accounts/1406710/monitors/454add9d-3b29-4fad-9bc9-25ce72d8f16a

Currently this will run every 5 minutes to check for elements on i.stuff.co.nz.

```javascript
const assert = require('assert');
const blackListed = ['https://somniture.stuff.co.nz'];
$browser.addHostnamesToBlacklist(blackListed);

const getCssElement = (selector) => {
  return $browser.waitForAndFindElement($driver.By.css(selector), 8000);
};

const closeOLI = async () => {
  try {
    const OliCloseBtn = await $browser.waitForAndFindElement(
      $driver.By.partialLinkText('close ad'),
      10000
    );
    return OliCloseBtn.click();
  } catch (e) {
    console.log('OLI was not found');
  }
};

const shouldContainBasicArticleUnits = async () => {
  const element = await getCssElement('app-basic-article-unit');
  return assert(element.getText() != null, 'app-basic-article-unit is null');
};

const shouldContainHeader = async () => {
  const element = await getCssElement('app-header');
  return assert(element != null, 'app-header element is null');
};

const shouldContainBasicAdUnit = async () => {
  const element = await getCssElement('app-basic-ad-unit[id] iframe');
  return assert(element != null, 'no ad unit is found');
};

const shouldContainTopStories = async () => {
  const element = await getCssElement('.container > app-basic-article-unit');
  return assert(element != null, 'top stories is null');
};

const shouldContainFooter = async () => {
  const element = await getCssElement('app-footer');
  return assert(element != null, 'footer element is null');
};

$browser
  .get('https://i.stuff.co.nz')
  .then(function() {
    console.log('checking oli, closing it if found');
    return closeOLI();
  })
  .then(function() {
    console.log('checking for article unit, no error means ok');
    return shouldContainBasicArticleUnits();
  })
  .then(function() {
    console.log('checking header, no error means ok');
    return shouldContainHeader();
  })
  .then(function() {
    console.log('checking top stories, no error means ok');
    return shouldContainTopStories();
  })
  .then(function() {
    console.log('checking ad unit, no error means ok');
    return shouldContainBasicAdUnit();
  })
  .then(function() {
    console.log('checking footer, no error means ok');
    return shouldContainFooter();
  });
```
